{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/db/supabaseClient.ts"],"sourcesContent":["import { resolve } from \"path\";\nimport dotenv from \"dotenv\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// Carga .env.local desde la ra√≠z del proyecto (solo en desarrollo local)\n// En producci√≥n (Vercel), las variables de entorno se cargan autom√°ticamente\nif (process.env.NODE_ENV !== \"production\") {\n  dotenv.config({ path: resolve(process.cwd(), \".env.local\") });\n}\n\nconst url = process.env.SUPABASE_URL;\nconst key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!url || !key) {\n  console.error(\"‚ùå [supabaseClient] SUPABASE_URL:\", url ? \"‚úÖ Configurado\" : \"‚ùå No configurado\");\n  console.error(\"‚ùå [supabaseClient] SUPABASE_SERVICE_ROLE_KEY:\", key ? \"‚úÖ Configurado\" : \"‚ùå No configurado\");\n  console.error(\"‚ùå [supabaseClient] NODE_ENV:\", process.env.NODE_ENV);\n  throw new Error(\"‚ùå Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY.\");\n}\n\n// Crear cliente con SERVICE_ROLE_KEY para bypass RLS\n// El SERVICE_ROLE_KEY tiene permisos completos y bypass todas las pol√≠ticas RLS\nexport const supabase = createClient(url, key, {\n  auth: {\n    persistSession: false,\n    autoRefreshToken: false,\n  },\n  // Asegurar que usamos el service role key correctamente\n  global: {\n    headers: {\n      'apikey': key,\n    },\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,yEAAyE;AACzE,6EAA6E;AAC7E,wCAA2C;IACzC,kKAAM,CAAC,MAAM,CAAC;QAAE,MAAM,IAAA,4GAAO,EAAC,QAAQ,GAAG,IAAI;IAAc;AAC7D;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY;AACpC,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;AAEjD,IAAI,CAAC,OAAO,CAAC,KAAK;IAChB,QAAQ,KAAK,CAAC,oCAAoC,MAAM,kBAAkB;IAC1E,QAAQ,KAAK,CAAC,iDAAiD,MAAM,kBAAkB;IACvF,QAAQ,KAAK,CAAC;IACd,MAAM,IAAI,MAAM;AAClB;AAIO,MAAM,WAAW,IAAA,yNAAY,EAAC,KAAK,KAAK;IAC7C,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;IACpB;IACA,wDAAwD;IACxD,QAAQ;QACN,SAAS;YACP,UAAU;QACZ;IACF;AACF"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/app/api/hyperconnector/id/%5Bid%5D/jobs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { supabase } from \"@/src/db/supabaseClient\";\n\n/**\n * GET /api/hyperconnector/id/[id]/jobs\n * Obtiene los jobs donde el hyperconnector tiene candidatos elegibles\n * Versi√≥n sin token, para uso con login directo\n */\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id: hyperconnectorId } = await params;\n\n    if (!hyperconnectorId) {\n      return NextResponse.json(\n        { error: \"Hyperconnector ID requerido\" },\n        { status: 400 }\n      );\n    }\n\n    console.log(\"üîç Obteniendo jobs para hyperconnector:\", hyperconnectorId);\n\n    // Obtener informaci√≥n del hyperconnector\n    const { data: hyperconnector, error: hciError } = await supabase\n      .from(\"hyperconnectors\")\n      .select(\"id, full_name\")\n      .eq(\"id\", hyperconnectorId)\n      .maybeSingle();\n\n    if (hciError) {\n      console.error(\"‚ùå Error obteniendo hyperconnector:\", hciError);\n      // No cortamos con 404 para no romper la UI: devolvemos lista vac√≠a\n      return NextResponse.json(\n        {\n          jobs: [],\n          hyperconnector: null,\n          hyperconnectorId,\n          message: \"No se pudo obtener el hyperconnector\",\n        },\n        { status: 200 }\n      );\n    }\n\n    if (!hyperconnector) {\n      console.warn(\"‚ö†Ô∏è Hyperconnector no encontrado en la BD:\", hyperconnectorId);\n      // En lugar de 404 devolvemos 200 con lista vac√≠a para evitar errores en la UI\n      return NextResponse.json(\n        {\n          jobs: [],\n          hyperconnector: null,\n          hyperconnectorId,\n          message: \"Hyperconnector no encontrado\",\n        },\n        { status: 200 }\n      );\n    }\n\n    // Obtener candidatos relacionados con el hyperconnector\n    const { data: hyperconnectorCandidates, error: hciCandidatesError } = await supabase\n      .from(\"hyperconnector_candidates\")\n      .select(\"candidate_id\")\n      .eq(\"hyperconnector_id\", hyperconnectorId);\n\n    if (hciCandidatesError) {\n      console.error(\"‚ùå Error obteniendo candidatos del hyperconnector:\", hciCandidatesError);\n      return NextResponse.json(\n        { error: \"Error al obtener candidatos\" },\n        { status: 500 }\n      );\n    }\n\n    if (!hyperconnectorCandidates || hyperconnectorCandidates.length === 0) {\n      console.log(\"‚ö†Ô∏è Hyperconnector no tiene candidatos relacionados\");\n      return NextResponse.json({\n        jobs: [],\n        hyperconnector,\n        hyperconnectorId,\n        message: \"No hay candidatos relacionados con este hyperconnector\",\n      });\n    }\n\n    const candidateIds = hyperconnectorCandidates.map((hc: any) => hc.candidate_id);\n\n    // Obtener jobs que tienen matches con estos candidatos\n    const { data: jobMatches, error: matchesError } = await supabase\n      .from(\"job_candidate_matches\")\n      .select(\"job_id\")\n      .in(\"candidate_id\", candidateIds);\n\n    if (matchesError) {\n      console.error(\"‚ùå Error obteniendo matches:\", matchesError);\n      return NextResponse.json(\n        { error: \"Error al obtener matches\" },\n        { status: 500 }\n      );\n    }\n\n    if (!jobMatches || jobMatches.length === 0) {\n      console.log(\"‚ö†Ô∏è No hay matches para estos candidatos\");\n      return NextResponse.json({\n        jobs: [],\n        hyperconnector,\n        hyperconnectorId,\n        message: \"No hay jobs con matches para los candidatos relacionados\",\n      });\n    }\n\n    const jobIds = [...new Set(jobMatches.map((jm: any) => jm.job_id))];\n\n    // Obtener detalles de los jobs\n    // Mostrar jobs activos (excluir solo los cerrados/cancelados)\n    const { data: allJobs, error: jobsError } = await supabase\n      .from(\"jobs\")\n      .select(\"id, company_name, job_title, description, owner_candidate_id, owner_role_title, status\")\n      .in(\"id\", jobIds);\n    \n    if (jobsError) {\n      console.error(\"‚ùå Error obteniendo jobs:\", jobsError);\n      return NextResponse.json(\n        { error: \"Error al obtener jobs\" },\n        { status: 500 }\n      );\n    }\n    \n    // Filtrar jobs activos (excluir contratados - hired)\n    const jobs = (allJobs || []).filter(\n      (job: any) => job.status !== \"hired\"\n    );\n\n    if (jobsError) {\n      console.error(\"‚ùå Error obteniendo jobs:\", jobsError);\n      return NextResponse.json(\n        { error: \"Error al obtener jobs\" },\n        { status: 500 }\n      );\n    }\n\n    // Para cada job, obtener el mejor match score y contar candidatos elegibles\n    const jobsWithDetails = await Promise.all(\n      (jobs || []).map(async (job: any) => {\n        // Obtener matches para este job con candidatos del hyperconnector\n        const { data: matches } = await supabase\n          .from(\"job_candidate_matches\")\n          .select(\"match_score, candidate_id\")\n          .eq(\"job_id\", job.id)\n          .in(\"candidate_id\", candidateIds);\n\n        const matchScores = (matches || []).map((m: any) => m.match_score || 0);\n        const bestMatchScore = matchScores.length > 0 ? Math.max(...matchScores) : null;\n        const eligibleCandidatesCount = matches?.length || 0;\n\n        // Obtener informaci√≥n del owner candidate\n        let ownerCandidate = null;\n        if (job.owner_candidate_id) {\n          const { data: owner } = await supabase\n            .from(\"candidates\")\n            .select(\"id, full_name, current_company, email\")\n            .eq(\"id\", job.owner_candidate_id)\n            .maybeSingle();\n          ownerCandidate = owner;\n        }\n\n        // Obtener conteo de recomendaciones del hyperconnector para este job\n        const { data: myRecommendations } = await supabase\n          .from(\"recommendations\")\n          .select(\"id\")\n          .eq(\"job_id\", job.id)\n          .eq(\"hyperconnector_id\", hyperconnectorId);\n\n        const myRecommendationsCount = myRecommendations?.length || 0;\n\n        return {\n          id: job.id,\n          company_name: job.company_name,\n          job_title: job.job_title,\n          role_title: job.job_title,\n          description: job.description,\n          owner_role: job.owner_role_title,\n          owner_candidate_id: job.owner_candidate_id,\n          eligibleCandidatesCount,\n          bestMatchScore,\n          ownerCandidate,\n          myRecommendationsCount,\n        };\n      })\n    );\n\n    console.log(`‚úÖ Encontrados ${jobsWithDetails.length} jobs elegibles`);\n\n    return NextResponse.json({\n      jobs: jobsWithDetails,\n      hyperconnector,\n      hyperconnectorId,\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå Error en GET /api/hyperconnector/id/[id]/jobs:\", error);\n    return NextResponse.json(\n      { error: \"Error interno del servidor\" },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}