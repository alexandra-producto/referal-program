{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/types/jobCreation.ts"],"sourcesContent":["/**\n * DTO para crear un job desde la UI\n */\nexport interface CreateJobRequest {\n  jobTitle: string;\n  description: string;\n  nonNegotiables: string;\n  desiredTrajectory: string;\n  scenario: string;\n  technicalBackgroundNeeded: boolean;\n  modality: 'remote' | 'hybrid' | 'onsite';\n}\n\n/**\n * Estructura del objeto requirements_json que se guarda en la BD\n */\nexport interface RequirementsJson {\n  non_negotiables_text: string;\n  desired_trajectory_text: string;\n  scenario_text: string;\n  needs_technical_background: boolean;\n  modality: 'remote' | 'hybrid' | 'onsite';\n}\n\n/**\n * Valida el body del request\n */\nexport function validateCreateJobRequest(body: any): { valid: boolean; error?: string; data?: CreateJobRequest } {\n  if (!body) {\n    return { valid: false, error: 'Request body is required' };\n  }\n\n  const { jobTitle, description, nonNegotiables, desiredTrajectory, scenario, technicalBackgroundNeeded, modality } = body;\n\n  // Validar campos requeridos\n  if (!jobTitle || typeof jobTitle !== 'string' || jobTitle.trim().length === 0) {\n    return { valid: false, error: 'jobTitle is required and must be a non-empty string' };\n  }\n\n  if (!description || typeof description !== 'string' || description.trim().length === 0) {\n    return { valid: false, error: 'description is required and must be a non-empty string' };\n  }\n\n  if (!nonNegotiables || typeof nonNegotiables !== 'string') {\n    return { valid: false, error: 'nonNegotiables is required and must be a string' };\n  }\n\n  if (!desiredTrajectory || typeof desiredTrajectory !== 'string') {\n    return { valid: false, error: 'desiredTrajectory is required and must be a string' };\n  }\n\n  if (!scenario || typeof scenario !== 'string') {\n    return { valid: false, error: 'scenario is required and must be a string' };\n  }\n\n  if (typeof technicalBackgroundNeeded !== 'boolean') {\n    return { valid: false, error: 'technicalBackgroundNeeded is required and must be a boolean' };\n  }\n\n  if (!modality || !['remote', 'hybrid', 'onsite'].includes(modality)) {\n    return { valid: false, error: 'modality is required and must be one of: remote, hybrid, onsite' };\n  }\n\n  return {\n    valid: true,\n    data: {\n      jobTitle: jobTitle.trim(),\n      description: description.trim(),\n      nonNegotiables: nonNegotiables.trim(),\n      desiredTrajectory: desiredTrajectory.trim(),\n      scenario: scenario.trim(),\n      technicalBackgroundNeeded,\n      modality,\n    },\n  };\n}\n\n/**\n * Construye el objeto requirements_json a partir del request\n */\nexport function buildRequirementsJson(request: CreateJobRequest): RequirementsJson {\n  return {\n    non_negotiables_text: request.nonNegotiables,\n    desired_trajectory_text: request.desiredTrajectory,\n    scenario_text: request.scenario,\n    needs_technical_background: request.technicalBackgroundNeeded,\n    modality: request.modality,\n  };\n}\n\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;AAyBM,SAAS,yBAAyB,IAAS;IAChD,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,OAAO;YAAO,OAAO;QAA2B;IAC3D;IAEA,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,cAAc,EAAE,iBAAiB,EAAE,QAAQ,EAAE,yBAAyB,EAAE,QAAQ,EAAE,GAAG;IAEpH,4BAA4B;IAC5B,IAAI,CAAC,YAAY,OAAO,aAAa,YAAY,SAAS,IAAI,GAAG,MAAM,KAAK,GAAG;QAC7E,OAAO;YAAE,OAAO;YAAO,OAAO;QAAsD;IACtF;IAEA,IAAI,CAAC,eAAe,OAAO,gBAAgB,YAAY,YAAY,IAAI,GAAG,MAAM,KAAK,GAAG;QACtF,OAAO;YAAE,OAAO;YAAO,OAAO;QAAyD;IACzF;IAEA,IAAI,CAAC,kBAAkB,OAAO,mBAAmB,UAAU;QACzD,OAAO;YAAE,OAAO;YAAO,OAAO;QAAkD;IAClF;IAEA,IAAI,CAAC,qBAAqB,OAAO,sBAAsB,UAAU;QAC/D,OAAO;YAAE,OAAO;YAAO,OAAO;QAAqD;IACrF;IAEA,IAAI,CAAC,YAAY,OAAO,aAAa,UAAU;QAC7C,OAAO;YAAE,OAAO;YAAO,OAAO;QAA4C;IAC5E;IAEA,IAAI,OAAO,8BAA8B,WAAW;QAClD,OAAO;YAAE,OAAO;YAAO,OAAO;QAA8D;IAC9F;IAEA,IAAI,CAAC,YAAY,CAAC;QAAC;QAAU;QAAU;KAAS,CAAC,QAAQ,CAAC,WAAW;QACnE,OAAO;YAAE,OAAO;YAAO,OAAO;QAAkE;IAClG;IAEA,OAAO;QACL,OAAO;QACP,MAAM;YACJ,UAAU,SAAS,IAAI;YACvB,aAAa,YAAY,IAAI;YAC7B,gBAAgB,eAAe,IAAI;YACnC,mBAAmB,kBAAkB,IAAI;YACzC,UAAU,SAAS,IAAI;YACvB;YACA;QACF;IACF;AACF;AAKO,SAAS,sBAAsB,OAAyB;IAC7D,OAAO;QACL,sBAAsB,QAAQ,cAAc;QAC5C,yBAAyB,QAAQ,iBAAiB;QAClD,eAAe,QAAQ,QAAQ;QAC/B,4BAA4B,QAAQ,yBAAyB;QAC7D,UAAU,QAAQ,QAAQ;IAC5B;AACF"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/db/supabaseClient.ts"],"sourcesContent":["import { resolve } from \"path\";\nimport dotenv from \"dotenv\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// Carga .env.local desde la raíz del proyecto\ndotenv.config({ path: resolve(process.cwd(), \".env.local\") });\n\nconst url = process.env.SUPABASE_URL;\nconst key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!url || !key) {\n  console.error(\"SUPABASE_URL:\", url);\n  console.error(\"SUPABASE_SERVICE_ROLE_KEY:\", key);\n  throw new Error(\"❌ Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY.\");\n}\n\nexport const supabase = createClient(url, key);\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,8CAA8C;AAC9C,kKAAM,CAAC,MAAM,CAAC;IAAE,MAAM,IAAA,4GAAO,EAAC,QAAQ,GAAG,IAAI;AAAc;AAE3D,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY;AACpC,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;AAEjD,IAAI,CAAC,OAAO,CAAC,KAAK;IAChB,QAAQ,KAAK,CAAC,iBAAiB;IAC/B,QAAQ,KAAK,CAAC,8BAA8B;IAC5C,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,WAAW,IAAA,yNAAY,EAAC,KAAK"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/domain/candidates.ts"],"sourcesContent":["import { supabase } from \"../db/supabaseClient\";\n\nexport async function getAllCandidates() {\n  const { data, error } = await supabase.from(\"candidates\").select(\"*\");\n  if (error) throw error;\n  return data;\n}\n\nexport async function getCandidateById(id: string) {\n  const { data, error } = await supabase.from(\"candidates\").select(\"*\").eq(\"id\", id).maybeSingle();\n  if (error) throw error;\n  return data;\n}\n\n/**\n * Creates a new candidate and optionally triggers matching with all jobs\n */\nexport async function createCandidate(\n  candidate: any,\n  options?: { triggerMatching?: boolean }\n) {\n  const { data, error } = await supabase\n    .from(\"candidates\")\n    .insert(candidate)\n    .select()\n    .single();\n  \n  if (error) throw error;\n\n  // Trigger matching if requested (non-blocking)\n  if (options?.triggerMatching && data?.id) {\n    // Run asynchronously to not block the insert\n    import(\"../agents/matchJobCandidate\")\n      .then(({ matchCandidateWithAllJobs }) => {\n        matchCandidateWithAllJobs(data.id).catch((err) => {\n          console.error(\"Error in background matching after candidate creation:\", err);\n        });\n      })\n      .catch((err) => {\n        console.error(\"Error loading matching module:\", err);\n      });\n  }\n\n  // Trigger relationship sync (non-blocking)\n  if (data?.id) {\n    import(\"../agents/syncHyperconnectorRelationships\")\n      .then(({ syncHyperconnectorCandidateRelationshipsForCandidate }) => {\n        syncHyperconnectorCandidateRelationshipsForCandidate(data.id).catch((err) => {\n          console.error(\"Error in background relationship sync after candidate creation:\", err);\n        });\n      })\n      .catch((err) => {\n        console.error(\"Error loading relationship sync module:\", err);\n      });\n  }\n\n  return data;\n}\n\nexport async function updateCandidate(id: string, updates: any) {\n  const { data, error } = await supabase.from(\"candidates\").update(updates).eq(\"id\", id).select().single();\n  if (error) throw error;\n  return data;\n}\n\nexport async function deleteCandidate(id: string) {\n  const { error } = await supabase.from(\"candidates\").delete().eq(\"id\", id);\n  if (error) throw error;\n  return true;\n}\n\n/**\n * Upsert: crea o actualiza un candidate por user_id, email o linkedin_id\n */\nexport async function upsertCandidate(candidateData: {\n  user_id?: string;\n  email?: string;\n  full_name?: string;\n  current_company?: string | null;\n  current_job_title?: string | null;\n  linkedin_url?: string | null;\n}): Promise<any> {\n  // Buscar candidate existente\n  let existing = null;\n\n  // Prioridad 1: Buscar por user_id (más confiable)\n  if (candidateData.user_id) {\n    const { data } = await supabase\n      .from(\"candidates\")\n      .select(\"*\")\n      .eq(\"user_id\", candidateData.user_id)\n      .maybeSingle();\n    existing = data;\n  }\n\n  // Prioridad 2: Buscar por email si no se encontró por user_id\n  if (!existing && candidateData.email) {\n    const { data } = await supabase\n      .from(\"candidates\")\n      .select(\"*\")\n      .eq(\"email\", candidateData.email)\n      .maybeSingle();\n    existing = data;\n  }\n\n  if (existing) {\n    // Actualizar\n    const { data, error } = await supabase\n      .from(\"candidates\")\n      .update({\n        ...candidateData,\n        updated_at: new Date().toISOString(),\n      })\n      .eq(\"id\", existing.id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  } else {\n    // Crear nuevo\n    return await createCandidate(candidateData, { triggerMatching: true });\n  }\n}\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAEO,eAAe;IACpB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC;IACjE,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,iBAAiB,EAAU;IAC/C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,KAAK,EAAE,CAAC,MAAM,IAAI,WAAW;IAC9F,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAKO,eAAe,gBACpB,SAAc,EACd,OAAuC;IAEvC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CACnC,IAAI,CAAC,cACL,MAAM,CAAC,WACP,MAAM,GACN,MAAM;IAET,IAAI,OAAO,MAAM;IAEjB,+CAA+C;IAC/C,IAAI,SAAS,mBAAmB,MAAM,IAAI;QACxC,6CAA6C;QAC7C,wHACG,IAAI,CAAC,CAAC,EAAE,yBAAyB,EAAE;YAClC,0BAA0B,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;gBACxC,QAAQ,KAAK,CAAC,0DAA0D;YAC1E;QACF,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACJ;IAEA,2CAA2C;IAC3C,IAAI,MAAM,IAAI;QACZ,sIACG,IAAI,CAAC,CAAC,EAAE,oDAAoD,EAAE;YAC7D,qDAAqD,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;gBACnE,QAAQ,KAAK,CAAC,mEAAmE;YACnF;QACF,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,2CAA2C;QAC3D;IACJ;IAEA,OAAO;AACT;AAEO,eAAe,gBAAgB,EAAU,EAAE,OAAY;IAC5D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,SAAS,EAAE,CAAC,MAAM,IAAI,MAAM,GAAG,MAAM;IACtG,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,gBAAgB,EAAU;IAC9C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,MAAM;IACtE,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAKO,eAAe,gBAAgB,aAOrC;IACC,6BAA6B;IAC7B,IAAI,WAAW;IAEf,kDAAkD;IAClD,IAAI,cAAc,OAAO,EAAE;QACzB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,yJAAQ,CAC5B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,cAAc,OAAO,EACnC,WAAW;QACd,WAAW;IACb;IAEA,8DAA8D;IAC9D,IAAI,CAAC,YAAY,cAAc,KAAK,EAAE;QACpC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,yJAAQ,CAC5B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,SAAS,cAAc,KAAK,EAC/B,WAAW;QACd,WAAW;IACb;IAEA,IAAI,UAAU;QACZ,aAAa;QACb,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CACnC,IAAI,CAAC,cACL,MAAM,CAAC;YACN,GAAG,aAAa;YAChB,YAAY,IAAI,OAAO,WAAW;QACpC,GACC,EAAE,CAAC,MAAM,SAAS,EAAE,EACpB,MAAM,GACN,MAAM;QAET,IAAI,OAAO,MAAM;QACjB,OAAO;IACT,OAAO;QACL,cAAc;QACd,OAAO,MAAM,gBAAgB,eAAe;YAAE,iBAAiB;QAAK;IACtE;AACF"}},
    {"offset": {"line": 279, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/domain/jobs.ts"],"sourcesContent":["import { supabase } from \"../db/supabaseClient\";\n\nexport async function getJobById(id: string) {\n  const { data, error } = await supabase\n    .from(\"jobs\")\n    .select(\"*\")\n    .eq(\"id\", id)\n    .maybeSingle();\n\n  if (error) throw new Error(error.message);\n  return data;\n}\n\n// Para este test: buscar el rol de Vemo por nombre de empresa\nexport async function getJobByCompanyNameLike(company: string) {\n  const { data, error } = await supabase\n    .from(\"jobs\")\n    .select(\"*\")\n    .ilike(\"company_name\", `%${company}%`)\n    .limit(1)\n    .maybeSingle();\n\n  if (error) throw new Error(error.message);\n  return data;\n}\n\n/**\n * Creates a new job and optionally triggers matching with all candidates\n */\nexport async function createJob(\n  job: any,\n  options?: { triggerMatching?: boolean }\n) {\n  const { data, error } = await supabase\n    .from(\"jobs\")\n    .insert(job)\n    .select()\n    .single();\n\n  if (error) throw new Error(error.message);\n\n  // Trigger matching if requested (non-blocking)\n  if (options?.triggerMatching && data?.id) {\n    // Run asynchronously to not block the insert\n    import(\"../agents/matchJobCandidate\")\n      .then(({ matchJobWithAllCandidates }) => {\n        matchJobWithAllCandidates(data.id).catch((err) => {\n          console.error(\"Error in background matching after job creation:\", err);\n        });\n      })\n      .catch((err) => {\n        console.error(\"Error loading matching module:\", err);\n      });\n  }\n\n  return data;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,eAAe,WAAW,EAAU;IACzC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CACnC,IAAI,CAAC,QACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,IACT,WAAW;IAEd,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IACxC,OAAO;AACT;AAGO,eAAe,wBAAwB,OAAe;IAC3D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CACnC,IAAI,CAAC,QACL,MAAM,CAAC,KACP,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EACpC,KAAK,CAAC,GACN,WAAW;IAEd,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IACxC,OAAO;AACT;AAKO,eAAe,UACpB,GAAQ,EACR,OAAuC;IAEvC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yJAAQ,CACnC,IAAI,CAAC,QACL,MAAM,CAAC,KACP,MAAM,GACN,MAAM;IAET,IAAI,OAAO,MAAM,IAAI,MAAM,MAAM,OAAO;IAExC,+CAA+C;IAC/C,IAAI,SAAS,mBAAmB,MAAM,IAAI;QACxC,6CAA6C;QAC7C,wHACG,IAAI,CAAC,CAAC,EAAE,yBAAyB,EAAE;YAClC,0BAA0B,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC;gBACxC,QAAQ,KAAK,CAAC,oDAAoD;YACpE;QACF,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACJ;IAEA,OAAO;AACT"}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/services/jobCreationService.ts"],"sourcesContent":["import { getCandidateById } from '../domain/candidates';\nimport { createJob } from '../domain/jobs';\nimport { CreateJobRequest, buildRequirementsJson } from '../types/jobCreation';\nimport { supabase } from '../db/supabaseClient';\n\n/**\n * Obtiene el título actual del candidate desde candidate_experience si está disponible\n */\nasync function getCandidateCurrentTitle(candidateId: string): Promise<string | null> {\n  try {\n    // Primero intentar obtener desde candidate_experience\n    const { data: experienceData } = await supabase\n      .from('candidate_experience')\n      .select('title')\n      .eq('candidate_id', candidateId)\n      .eq('is_current', true)\n      .order('start_date', { ascending: false })\n      .limit(1)\n      .maybeSingle();\n\n    if (experienceData?.title) {\n      return experienceData.title;\n    }\n\n    return null;\n  } catch (error) {\n    console.warn('Error fetching candidate experience:', error);\n    return null;\n  }\n}\n\n/**\n * Crea un job desde un candidate logueado\n * \n * @param candidateId - ID del candidate logueado\n * @param request - Datos del job desde la UI\n * @returns El job creado\n */\nexport async function createJobFromCandidate(\n  candidateId: string,\n  request: CreateJobRequest\n) {\n  // 1. Buscar el candidate\n  const candidate = await getCandidateById(candidateId);\n  if (!candidate) {\n    throw new Error(`Candidate with id ${candidateId} not found`);\n  }\n\n  // 2. Obtener company_name del candidate\n  const companyName = candidate.current_company;\n  if (!companyName) {\n    throw new Error('Candidate must have a current_company to create a job');\n  }\n\n  // 3. Obtener owner_role_title (intentar desde current_job_title o candidate_experience)\n  let ownerRoleTitle: string | null = candidate.current_job_title || null;\n  \n  if (!ownerRoleTitle) {\n    ownerRoleTitle = await getCandidateCurrentTitle(candidateId);\n  }\n\n  // 4. Calcular remote_ok según la modalidad\n  const remoteOk = request.modality === 'remote' || request.modality === 'hybrid';\n\n  // 5. Construir requirements_json\n  const requirementsJson = buildRequirementsJson(request);\n\n  // 6. Crear el objeto job\n  const jobData = {\n    company_name: companyName,\n    job_title: request.jobTitle,\n    job_level: null, // V1: no se usa\n    location: null, // V1: no se usa\n    remote_ok: remoteOk,\n    description: request.description,\n    requirements_json: requirementsJson,\n    status: 'open',\n    owner_candidate_id: candidateId,\n    owner_role_title: ownerRoleTitle,\n  };\n\n  // 7. Crear el job (con matching automático)\n  const job = await createJob(jobData, { triggerMatching: true });\n\n  return job;\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA;;CAEC,GACD,eAAe,yBAAyB,WAAmB;IACzD,IAAI;QACF,sDAAsD;QACtD,MAAM,EAAE,MAAM,cAAc,EAAE,GAAG,MAAM,yJAAQ,CAC5C,IAAI,CAAC,wBACL,MAAM,CAAC,SACP,EAAE,CAAC,gBAAgB,aACnB,EAAE,CAAC,cAAc,MACjB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,GACN,WAAW;QAEd,IAAI,gBAAgB,OAAO;YACzB,OAAO,eAAe,KAAK;QAC7B;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,wCAAwC;QACrD,OAAO;IACT;AACF;AASO,eAAe,uBACpB,WAAmB,EACnB,OAAyB;IAEzB,yBAAyB;IACzB,MAAM,YAAY,MAAM,IAAA,iKAAgB,EAAC;IACzC,IAAI,CAAC,WAAW;QACd,MAAM,IAAI,MAAM,CAAC,kBAAkB,EAAE,YAAY,UAAU,CAAC;IAC9D;IAEA,wCAAwC;IACxC,MAAM,cAAc,UAAU,eAAe;IAC7C,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,wFAAwF;IACxF,IAAI,iBAAgC,UAAU,iBAAiB,IAAI;IAEnE,IAAI,CAAC,gBAAgB;QACnB,iBAAiB,MAAM,yBAAyB;IAClD;IAEA,2CAA2C;IAC3C,MAAM,WAAW,QAAQ,QAAQ,KAAK,YAAY,QAAQ,QAAQ,KAAK;IAEvE,iCAAiC;IACjC,MAAM,mBAAmB,IAAA,sKAAqB,EAAC;IAE/C,yBAAyB;IACzB,MAAM,UAAU;QACd,cAAc;QACd,WAAW,QAAQ,QAAQ;QAC3B,WAAW;QACX,UAAU;QACV,WAAW;QACX,aAAa,QAAQ,WAAW;QAChC,mBAAmB;QACnB,QAAQ;QACR,oBAAoB;QACpB,kBAAkB;IACpB;IAEA,4CAA4C;IAC5C,MAAM,MAAM,MAAM,IAAA,oJAAS,EAAC,SAAS;QAAE,iBAAiB;IAAK;IAE7D,OAAO;AACT"}},
    {"offset": {"line": 391, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/app/api/jobs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { validateCreateJobRequest } from '../../../src/types/jobCreation';\nimport { createJobFromCandidate } from '../../../src/services/jobCreationService';\n\n/**\n * GET /api/jobs\n * Obtiene los jobs filtrados por owner_candidate_id (opcional)\n * \n * Query params:\n * - owner_candidate_id: UUID del candidate que creó los jobs\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const ownerCandidateId = searchParams.get('owner_candidate_id');\n\n    const { supabase } = await import('../../../src/db/supabaseClient');\n\n    let query = supabase.from('jobs').select('*');\n\n    if (ownerCandidateId) {\n      query = query.eq('owner_candidate_id', ownerCandidateId);\n    }\n\n    // Ordenar por fecha de creación (más recientes primero)\n    query = query.order('created_at', { ascending: false });\n\n    const { data: jobs, error } = await query;\n\n    if (error) {\n      console.error('❌ Error fetching jobs:', error);\n      return NextResponse.json(\n        { error: 'Error fetching jobs', details: error.message },\n        { status: 500 }\n      );\n    }\n\n    // Para cada job, obtener el conteo de recomendaciones\n    if (jobs && jobs.length > 0) {\n      const jobIds = jobs.map((j: any) => j.id);\n      \n      const { data: recommendations } = await supabase\n        .from('recommendations')\n        .select('job_id')\n        .in('job_id', jobIds);\n\n      // Contar recomendaciones por job\n      const recommendationCounts = new Map<string, number>();\n      if (recommendations) {\n        recommendations.forEach((r: any) => {\n          const count = recommendationCounts.get(r.job_id) || 0;\n          recommendationCounts.set(r.job_id, count + 1);\n        });\n      }\n\n      // Agregar conteo a cada job\n      const jobsWithCounts = jobs.map((job: any) => ({\n        ...job,\n        recommendations_count: recommendationCounts.get(job.id) || 0,\n      }));\n\n      return NextResponse.json({ jobs: jobsWithCounts });\n    }\n\n    return NextResponse.json({ jobs: [] });\n  } catch (error: any) {\n    console.error('❌ Error in GET /api/jobs:', error);\n    return NextResponse.json(\n      {\n        error: 'Error fetching jobs',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined,\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/jobs\n * Crea un nuevo job desde la UI de \"Crear solicitud de rol\"\n * \n * Body esperado:\n * {\n *   jobTitle: string,\n *   description: string,\n *   nonNegotiables: string,\n *   desiredTrajectory: string,\n *   scenario: string,\n *   technicalBackgroundNeeded: boolean,\n *   modality: 'remote' | 'hybrid' | 'onsite',\n *   candidateId: string (ID del candidate logueado)\n * }\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n\n    // Validar el body\n    const validation = validateCreateJobRequest(body);\n    if (!validation.valid || !validation.data) {\n      return NextResponse.json(\n        { error: validation.error || 'Invalid request body' },\n        { status: 400 }\n      );\n    }\n\n    // Obtener candidateId del body (en el futuro esto vendrá de la autenticación)\n    const candidateId = body.candidateId;\n    if (!candidateId || typeof candidateId !== 'string') {\n      return NextResponse.json(\n        { error: 'candidateId is required in the request body' },\n        { status: 400 }\n      );\n    }\n\n    // Crear el job\n    const job = await createJobFromCandidate(candidateId, validation.data);\n\n    return NextResponse.json(\n      {\n        success: true,\n        job,\n        message: 'Job created successfully',\n      },\n      { status: 201 }\n    );\n  } catch (error: any) {\n    console.error('❌ Error creating job:', error);\n    \n    // Manejar errores específicos\n    if (error.message?.includes('not found')) {\n      return NextResponse.json(\n        { error: error.message },\n        { status: 404 }\n      );\n    }\n\n    if (error.message?.includes('current_company')) {\n      return NextResponse.json(\n        { error: error.message },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        error: 'Error creating job',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined,\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}