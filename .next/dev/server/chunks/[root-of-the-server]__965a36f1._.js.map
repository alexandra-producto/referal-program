{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/src/utils/session.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\";\nimport { cookies } from \"next/headers\";\nimport { UserRole } from \"../domain/users\";\n\nconst SECRET_KEY = process.env.SESSION_SECRET || process.env.RECOMMENDATION_SECRET || \"fallback-secret-key-change-in-production\";\nconst secret = new TextEncoder().encode(SECRET_KEY);\n\nexport interface SessionData {\n  userId: string;\n  role: UserRole;\n  candidateId?: string | null;\n  hyperconnectorId?: string | null;\n  email: string;\n  fullName: string;\n}\n\n/**\n * Crea una sesión JWT y la guarda en una cookie httpOnly\n */\nexport async function createSession(data: SessionData): Promise<string> {\n  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 días\n\n  const token = await new SignJWT({\n    userId: data.userId,\n    role: data.role,\n    candidateId: data.candidateId,\n    hyperconnectorId: data.hyperconnectorId,\n    email: data.email,\n    fullName: data.fullName,\n  })\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(expiresAt)\n    .sign(secret);\n\n  return token;\n}\n\n/**\n * Verifica y obtiene los datos de la sesión desde la cookie\n */\nexport async function getSession(): Promise<SessionData | null> {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get(\"session\")?.value;\n\n    if (!token) {\n      return null;\n    }\n\n    const { payload } = await jwtVerify(token, secret);\n    \n    return {\n      userId: payload.userId as string,\n      role: payload.role as UserRole,\n      candidateId: (payload.candidateId as string) || null,\n      hyperconnectorId: (payload.hyperconnectorId as string) || null,\n      email: payload.email as string,\n      fullName: payload.fullName as string,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * Obtiene la sesión desde un token string (útil para API routes)\n */\nexport async function getSessionFromToken(token: string): Promise<SessionData | null> {\n  try {\n    const { payload } = await jwtVerify(token, secret);\n    \n    return {\n      userId: payload.userId as string,\n      role: payload.role as UserRole,\n      candidateId: (payload.candidateId as string) || null,\n      hyperconnectorId: (payload.hyperconnectorId as string) || null,\n      email: payload.email as string,\n      fullName: payload.fullName as string,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * Elimina la sesión (logout)\n */\nexport async function deleteSession(): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.delete(\"session\");\n}\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AACA;;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,cAAc,IAAI,QAAQ,GAAG,CAAC,qBAAqB,IAAI;AACtF,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC;AAcjC,eAAe,cAAc,IAAiB;IACnD,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK,OAAO,SAAS;IAE3E,MAAM,QAAQ,MAAM,IAAI,kLAAO,CAAC;QAC9B,QAAQ,KAAK,MAAM;QACnB,MAAM,KAAK,IAAI;QACf,aAAa,KAAK,WAAW;QAC7B,kBAAkB,KAAK,gBAAgB;QACvC,OAAO,KAAK,KAAK;QACjB,UAAU,KAAK,QAAQ;IACzB,GACG,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,WAClB,IAAI,CAAC;IAER,OAAO;AACT;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4JAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,YAAY;QAE1C,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sLAAS,EAAC,OAAO;QAE3C,OAAO;YACL,QAAQ,QAAQ,MAAM;YACtB,MAAM,QAAQ,IAAI;YAClB,aAAa,AAAC,QAAQ,WAAW,IAAe;YAChD,kBAAkB,AAAC,QAAQ,gBAAgB,IAAe;YAC1D,OAAO,QAAQ,KAAK;YACpB,UAAU,QAAQ,QAAQ;QAC5B;IACF,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAKO,eAAe,oBAAoB,KAAa;IACrD,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sLAAS,EAAC,OAAO;QAE3C,OAAO;YACL,QAAQ,QAAQ,MAAM;YACtB,MAAM,QAAQ,IAAI;YAClB,aAAa,AAAC,QAAQ,WAAW,IAAe;YAChD,kBAAkB,AAAC,QAAQ,gBAAgB,IAAe;YAC1D,OAAO,QAAQ,KAAK;YACpB,UAAU,QAAQ,QAAQ;QAC5B;IACF,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/app/api/auth/logout/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { deleteSession } from \"../../../../src/utils/session\";\n\n/**\n * POST /api/auth/logout\n * Cierra la sesión del usuario\n */\nexport async function POST(request: NextRequest) {\n  try {\n    await deleteSession();\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    console.error(\"Error cerrando sesión:\", error);\n    return NextResponse.json(\n      { error: \"Error al cerrar sesión\" },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAMO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,0JAAa;QACnB,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}