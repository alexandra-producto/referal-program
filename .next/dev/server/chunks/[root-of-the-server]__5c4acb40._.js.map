{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/usuario/Referal%20MVP/app/api/jobs/all/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabase } from '../../../src/db/supabaseClient';\n\n/**\n * GET /api/jobs/all\n * Obtiene todos los jobs con información del owner candidate y conteo de recomendaciones\n * Para uso del Admin\n */\nexport async function GET(request: NextRequest) {\n  try {\n    // Obtener todos los jobs\n    const { data: jobs, error: jobsError } = await supabase\n      .from('jobs')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (jobsError) {\n      console.error('❌ Error fetching jobs:', jobsError);\n      return NextResponse.json(\n        { error: 'Error fetching jobs', details: jobsError.message },\n        { status: 500 }\n      );\n    }\n\n    if (!jobs || jobs.length === 0) {\n      return NextResponse.json({ jobs: [] });\n    }\n\n    // Obtener IDs de jobs y owner candidates\n    const jobIds = jobs.map((j: any) => j.id);\n    const ownerCandidateIds = jobs\n      .map((j: any) => j.owner_candidate_id)\n      .filter((id: string | null) => id !== null);\n\n    // Obtener información de los owner candidates\n    let ownerCandidates: Map<string, any> = new Map();\n    if (ownerCandidateIds.length > 0) {\n      const { data: candidates, error: candidatesError } = await supabase\n        .from('candidates')\n        .select('id, full_name, current_company, current_job_title')\n        .in('id', ownerCandidateIds);\n\n      if (!candidatesError && candidates) {\n        candidates.forEach((c: any) => {\n          ownerCandidates.set(c.id, c);\n        });\n      }\n    }\n\n    // Obtener conteo de recomendaciones por job\n    const { data: recommendations } = await supabase\n      .from('recommendations')\n      .select('job_id')\n      .in('job_id', jobIds);\n\n    // Contar recomendaciones\n    const recommendationCounts = new Map<string, number>();\n    if (recommendations) {\n      recommendations.forEach((r: any) => {\n        const count = recommendationCounts.get(r.job_id) || 0;\n        recommendationCounts.set(r.job_id, count + 1);\n      });\n    }\n\n    // Combinar toda la información\n    // El status viene directamente de la tabla jobs\n    const jobsWithDetails = jobs.map((job: any) => {\n      const ownerCandidate = ownerCandidates.get(job.owner_candidate_id);\n      const recommendationsCount = recommendationCounts.get(job.id) || 0;\n\n      return {\n        ...job,\n        ownerCandidate: ownerCandidate || null,\n        recommendations_count: recommendationsCount,\n        // El status viene directamente de jobs.status\n        // Valores posibles: \"Esperando Recomendaciones\", \"Recomendaciones Recibidas\", \n        // \"En Proceso Reclutamiento\", \"Recomendaciones Rechazadas\", \"Recomendación Contratada\"\n      };\n    });\n\n    return NextResponse.json({ jobs: jobsWithDetails });\n  } catch (error: any) {\n    console.error('❌ Error in GET /api/jobs/all:', error);\n    return NextResponse.json(\n      {\n        error: 'Error fetching jobs',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined,\n      },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;;;;;;;;AAQO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,yBAAyB;QACzB,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAC5C,IAAI,CAAC,QACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,WAAW;YACb,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAuB,SAAS,UAAU,OAAO;YAAC,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC9B,OAAO,gKAAY,CAAC,IAAI,CAAC;gBAAE,MAAM,EAAE;YAAC;QACtC;QAEA,yCAAyC;QACzC,MAAM,SAAS,KAAK,GAAG,CAAC,CAAC,IAAW,EAAE,EAAE;QACxC,MAAM,oBAAoB,KACvB,GAAG,CAAC,CAAC,IAAW,EAAE,kBAAkB,EACpC,MAAM,CAAC,CAAC,KAAsB,OAAO;QAExC,8CAA8C;QAC9C,IAAI,kBAAoC,IAAI;QAC5C,IAAI,kBAAkB,MAAM,GAAG,GAAG;YAChC,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,eAAe,EAAE,GAAG,MAAM,SACxD,IAAI,CAAC,cACL,MAAM,CAAC,qDACP,EAAE,CAAC,MAAM;YAEZ,IAAI,CAAC,mBAAmB,YAAY;gBAClC,WAAW,OAAO,CAAC,CAAC;oBAClB,gBAAgB,GAAG,CAAC,EAAE,EAAE,EAAE;gBAC5B;YACF;QACF;QAEA,4CAA4C;QAC5C,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,SACrC,IAAI,CAAC,mBACL,MAAM,CAAC,UACP,EAAE,CAAC,UAAU;QAEhB,yBAAyB;QACzB,MAAM,uBAAuB,IAAI;QACjC,IAAI,iBAAiB;YACnB,gBAAgB,OAAO,CAAC,CAAC;gBACvB,MAAM,QAAQ,qBAAqB,GAAG,CAAC,EAAE,MAAM,KAAK;gBACpD,qBAAqB,GAAG,CAAC,EAAE,MAAM,EAAE,QAAQ;YAC7C;QACF;QAEA,+BAA+B;QAC/B,gDAAgD;QAChD,MAAM,kBAAkB,KAAK,GAAG,CAAC,CAAC;YAChC,MAAM,iBAAiB,gBAAgB,GAAG,CAAC,IAAI,kBAAkB;YACjE,MAAM,uBAAuB,qBAAqB,GAAG,CAAC,IAAI,EAAE,KAAK;YAEjE,OAAO;gBACL,GAAG,GAAG;gBACN,gBAAgB,kBAAkB;gBAClC,uBAAuB;YAIzB;QACF;QAEA,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAgB;IACnD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gKAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,uCAAyC,MAAM,OAAO,GAAG;QACpE,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}